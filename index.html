<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <title>My Savings Pots</title>
  <style>
    body { background-color: #f9fafb; }
    .pot-card { transition: all 0.2s ease-in-out; cursor: pointer; }
    .pot-card:hover { transform: scale(1.02); }
    .button-size { height: 38px; padding: 0 12px; } /* Ensures buttons are the same size as input fields */
    .icon-size { font-size: 18px; }
  </style>
</head>
<body class="p-4 font-sans">
  <div class="max-w-xl mx-auto">
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-2xl font-bold">üí∞ My Savings Pots</h1>
      <button id="expandBtn" onclick="toggleCreateForm()" class="bg-blue-500 text-white px-3 py-2 rounded-full">‚ûï</button>
    </div>

    <div id="createPotForm" class="mb-6 bg-white p-4 rounded-xl shadow hidden">
      <h2 class="font-semibold mb-2">Create New Pot</h2>
      <input id="potName" type="text" placeholder="Name (e.g., Europe Trip)" class="border p-2 w-full rounded mb-2">
      <input id="potGoal" type="number" placeholder="Goal Amount" class="border p-2 w-full rounded mb-2">
      <button onclick="createPot()" class="bg-blue-500 text-white px-4 py-2 rounded w-full">Add Pot</button>
    </div>

    <div id="potsContainer" class="space-y-4"></div>
  </div>

  <script>
    let pots = JSON.parse(localStorage.getItem('pots') || '[]');
    let expandedIndex = null;

    function toggleCreateForm() {
      const form = document.getElementById('createPotForm');
      form.classList.toggle('hidden');
    }

    function savePots() {
      localStorage.setItem('pots', JSON.stringify(pots));
    }

    function formatCurrency(value) {
      return `‚Çπ${value.toLocaleString()}`;
    }

    function formatTimestamp(timestamp) {
      const date = new Date(timestamp);
      return `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()} ${date.getHours()}:${date.getMinutes()}`;
    }

    function renderPots() {
      const container = document.getElementById('potsContainer');
      container.innerHTML = '';

      if (pots.length === 0) {
        container.innerHTML = '<div class="text-center p-10"><button onclick="toggleCreateForm()" class="bg-blue-500 text-white px-6 py-3 rounded">Create First Pot</button></div>';
        return;
      }

      pots.forEach((pot, index) => {
        const percentage = Math.min(100, (pot.amount / pot.goal) * 100);
        const potEl = document.createElement('div');
        potEl.className = 'bg-white rounded-xl shadow p-4 pot-card';
        potEl.ondblclick = () => {
          expandedIndex = expandedIndex === index ? null : index;
          renderPots();
        };

        let transactionsHTML = '';
        if (expandedIndex === index && pot.transactions) {
          if (pot.transactions.length === 0) {
            transactionsHTML = '<div class="text-center">No transactions yet</div>';
          } else {
            transactionsHTML = pot.transactions.map(transaction => {
              return `
                <div class="flex justify-between mb-2">
                  <span>${transaction.amount > 0 ? '‚ûï' : '‚ûñ'} ${formatCurrency(Math.abs(transaction.amount))}</span>
                  <span>(${formatTimestamp(transaction.timestamp)})</span>
                </div>
              `;
            }).join('');
          }
        }

        potEl.innerHTML = `
          <div class="flex justify-between items-center mb-1">
            <div class="font-semibold">${pot.name}</div>
            <div class="text-sm text-gray-500">${formatCurrency(pot.amount)} / ${formatCurrency(pot.goal)}</div>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2.5 mb-4">
            <div class="bg-green-500 h-2.5 rounded-full" style="width: ${percentage}%;"></div>
          </div>
          <div class="flex space-x-2">
            <input type="number" id="add-${index}" placeholder="Amount" class="border p-2 rounded w-full">
            <button onclick="addMoney(${index})" class="bg-green-500 text-white px-2 rounded button-size">‚ûï</button>
            <button onclick="removeMoney(${index})" class="bg-red-500 text-white px-2 rounded button-size">‚ûñ</button>
          </div>
          ${expandedIndex === index ? `
            <div class="mt-4">
              ${transactionsHTML}
              <button onclick="deletePot(${index})" class="text-red-500 mt-2 flex items-center space-x-2"><span>‚ùå</span><span>Delete Pot</span></button>
            </div>
          ` : ''}
        `;
        container.appendChild(potEl);
      });
    }

    function createPot() {
      const name = document.getElementById('potName').value;
      const goal = parseFloat(document.getElementById('potGoal').value);
      if (!name || isNaN(goal) || goal <= 0) return alert('Enter valid name and goal');
      pots.push({ name, goal, amount: 0, transactions: [] });
      savePots();
      renderPots();
      document.getElementById('potName').value = '';
      document.getElementById('potGoal').value = '';
    }

    function addMoney(index) {
      const input = document.getElementById(`add-${index}`);
      const amount = parseFloat(input.value);
      if (isNaN(amount) || amount <= 0) return;
      pots[index].amount += amount;
      pots[index].transactions.push({ amount, timestamp: Date.now() });
      savePots();
      renderPots();
    }

    function removeMoney(index) {
      const input = document.getElementById(`add-${index}`);
      const amount = parseFloat(input.value);
      if (isNaN(amount) || amount <= 0) return;
      pots[index].amount = Math.max(0, pots[index].amount - amount);
      pots[index].transactions.push({ amount: -amount, timestamp: Date.now() });
      savePots();
      renderPots();
    }

    function deletePot(index) {
      pots.splice(index, 1);
      savePots();
      renderPots();
    }

    window.onload = () => {
      renderPots();
    };
  </script>
</body>
</html>
